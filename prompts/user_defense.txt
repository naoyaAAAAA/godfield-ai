# user_defense.txt（改善・重複排除版）

このファイルは **phase="defense" 専用の戦略方針（B）** を記す。
絶対ルール（出力仕様・属性相性/usable・闇/特殊・リング/防具の扱い・フェーズ制約・incoming の読み方など）は **system_core.txt** に従うこと。
（出力フォーマットも system_core.txt の A-9 を厳守）

### A-5. 防御フェーズのルール

### 優先順位 0：【カウンターリーサル】（反射キル）

防御フェーズ開始時、まず「この攻撃をはね返せば相手を倒せるか？」をチェックせよ。

1. **反射・無効化系（スーパーミラー / 〜をはね返す）**
   - 条件:
     - 相手の攻撃ダメージ（または「売る」の価格）が、相手の残りHP以上である。
     - 手札にその攻撃を「はね返す」記述を持つカードがある。
   - 判断:
     - 自分がダメージを受けずに相手にそのまま返せるなら、**即座に使用して勝利せよ。**

2. **指輪カウンター（土星の指輪など）**
   - 条件:
     - 「受けたダメージの○倍を相手に与える」効果を持つ指輪がある。
     - (予想被ダメージ × 倍率) ≧ 相手HP である。
   - **重要確認:**
     - 指輪の効果発動には「自分がダメージを受ける」必要がある。
     - **そのダメージで自分のHPが0にならない（生き残れる）こと** を必ず確認せよ。
     - 「相打ち（引き分け）」になる場合は、他に勝ち筋がない時のみ実行せよ。
   - 判断:
     - 自分が耐えられ、かつ相手を倒せるなら、迷わず使用せよ。
  

--------------------------------------------------
B-7. 防御フェーズの方針（改訂版）
--------------------------------------------------

※本節は戦略方針（B）であり、Aセクションの絶対ルール（属性相性・闇の危険度・特殊防御・usable制約など）に反してはならない。
  判断が衝突する場合は A を優先する。

・**防具カードは、１度に何枚でも使用することができる**
・防具カードは「HPを守るためのリソース」であると同時に、
  「手札を循環させて強いカードを引き込むためのリソース」でもある。
・闇属性のカードに備えて最低限（合計防御力５～１０程度）の防具をキープしておくこと（いわゆる「闇ケア」）を除けば、
  一般的には「防具は積極的に使いまくった方が強い」と考えること。
- **「防具は手札回しの燃料」**
  - HPが満タンでも、弱い攻撃（1〜5ダメ）に対して安い防具（守1〜5）を積極的に切れ。
  - 防具を抱え落ちするより、使い切って新しいカードを引くほうが強い。
- **パスは敗北への近道**
  - `defense-pass` は、「ダメージが0〜1で、かつ手札に防具がない」場合以外は選ぶな。
  - 属性攻撃に対しても、虹のカーテンや反射がないか、3回確認してから諦めろ。
- ただし、incoming が 取引（買う/売る）でダメージが発生しないケースでは、defense-pass は合理的になり得る

・原則として、以下のように振る舞うこと：
  - 迷ったら defend を選び、防具を使う方向で考える。
  - defense-pass は「本当に例外的なケース」に限定する。

【具体的な防御の判断ルール】

1. 即死回避は絶対
   - 防御しないとこのターンに HP が 0 以下になる場合は、
     必ず defend を選び、防具を複数枚使ってでも確実に生き残る。
   - 致死回避がかかる局面では、過剰防御（オーバーキル気味に守る）になってもよい。
     死なないことが最優先。

2. 基本は「ほぼ毎回、防具を切る」
   - 予想被ダメージ（incoming の攻撃の合計）が 2 以上ある場合は、基本的に何かしらの防具を 1 枚以上使い、受けるダメージが２以下になるように攻撃を防ぎきる。
   - HP が高いかつ、防具が手札に複数枚あるなら、小さなダメージに対しても防具を複数枚切って手札を回すことを検討してよいが、基本的には A-5 のルール（防御力の小さい順に、必要最小枚数でダメージを回避）を基準とし、その「基準セット」に対して小さい防具を1〜2枚だけ追加する程度にとどめること。

   - 特に、「防具が3枚以上ある」「攻撃カードが少ない」など、防具がダブついているとき、相手の攻撃をふさぎ切る（ダメージを一切受けない）ように防具を選択すること。

   - 追加の数値ルール：
     - 期待/表示攻撃が 7 以上なら、原則として defense-pass を選ばない。
       例外は「属性的に防具が無効」「usable な防具が存在しない」場合のみ。

   - **相手の攻撃が闇属性である場合、ダメージを受けないよう注意すること。**　相手の攻撃が闇属性のときは、防具を選択したのち、確実にダメージをふさぎ切れる量の防具を使用していることを、再度確認すること。

3. 防具の使い方の優先順位
   - まずは「安くて防御力の小さい防具」を優先的に使う。
     - db.price が低く、db.defense も小さい防具を、手札を回すための“捨て札”としてどんどん切ってよい。

   - 予想被ダメージに対して、ほとんどすべてを防ぎきるイメージで防具を選ぶ。多少防御が過剰になってもよいが、「5ダメージに対して防御合計20以上」のような極端な過剰防御は避けること。


4. defense-pass を選んでよいケース（かなり限定的）
   - 次の条件をすべて満たす場合にのみ、defense-pass を検討してよい：
     - 予想被ダメージが 1 または 0 程度で非常に小さい。
     - me.hp が十分に高く（例：40 以上）、このダメージを受けても致死圏内にならない。

   - ただし、攻撃合計が 7 以上のときは本項より上の数値ルールが優先され、
     原則 defense-pass を選ばない。

   - 上記を満たさない場合は、原則として defense-pass は選ばず、何らかの防具を出すこと。

5. 闇ケアなど特殊な例外
   - 相手が闇属性などを持っていることをケアして、合計５ダメージ分程度の防具を温存してもよい

6. 手札回しとしての防具使用
   - 手札に防御力の低い防具カードが多く、かさばっているとき、**防御力の合計が過剰になったとしても気にせずに、防具を複数枚使うことで、手札を回転させ、より強力なカードを得ることができる。**手札に有力な攻撃カードがないとき、積極的に検討すること。
   例：攻１０に対して、「防１１」＋「防１」＋「防２」を切る。本来は「防１１」だけで十分間に合うが、「防１」と「防２」もあえて使用することで、手札を回転させている。

7. 状態異常付き攻撃（「ダメージで○○」）への防御

　- incoming のカードの description に「ダメージで風邪」「ダメージで熱病」「ダメージで地獄病」
  　など「ダメージで○○」が含まれている場合は、
  　純粋なダメージ以上に危険な攻撃とみなす。

　- 特に「ダメージで風邪」「ダメージで地獄病」は、放置すると熱病・地獄病につながり、
  　毎ターンの継続ダメージやさらなる悪化で大きなHP損になる。
  　よって、次を心がける：
  　- こちらのHPに十分余裕があっても、
  　   防具1〜2枚で簡単に0ダメージにできるなら、できるだけ完全に防ぐ。
  　   （2〜3点のオーバー防御は許容してよい。）
  　- すでに風邪・熱病・地獄病のいずれかを持っているときは、
  　   同系統の状態異常を追加で食らう価値はさらに低い。
  　   この場合も、可能なら0ダメージにすることを優先する。

  - さらに、自分の statuses に「天国病」が含まれているときは、
  「ダメージで風邪」「ダメージで熱病」「ダメージで地獄病」「ダメージで天国病」
  「病気が悪化する」などの効果を持つ攻撃は **実質的な即死攻撃** とみなす。

 　 - この状況では、incoming が小ダメージであっても、
 　   可能なかぎり 0ダメージ（病気付与を発動させない）になるように防具を切る。
 　 - 闇属性や大ダメージとの比較でも、
  　  「次のターン以降に発作で確実に死ぬ」リスクを避けることを最優先に考えてよい。

　　- まとめると、「ダメージで○○」付きの小ダメージ攻撃は、
  　　単なる小ダメージ攻撃よりも **防具をケチらず止めた方が期待値が高い** と判断してよい。

  8. 自分が「状態異常」のときの防御心得

- **自分が「閃光」のとき（1枚制限）：**
  - ルール上、防具は **1枚しか** 選べない。
  - 中途半端な防具（守3など）を出して貫通されるのが一番寒い。
  - 被弾が痛いなら、**手持ちで一番強い防具（守20やスーパーミラー等）を惜しまず切れ。**
  - 「温存して被弾」より「最強の1枚で完封」の方がマシである。

- **自分が「夢」のとき（ランダム事故）：**
  - 防具を選んでも、勝手に別のカードが出たり、パス扱いになるリスクがある。
  - **「この防具が外れたら死ぬ」というギリギリの計算をするな。**
  - 事故っても死なないよう、HPには常に余裕を持たせろ。
  - もし可能なら、防御フェーズであっても
    「状態異常回復（〜を払う、歌声）」や「夢を覚ますアイテム」の使用を最優先で検討せよ（※防御として使えるカードの場合のみ）。
    （※注：通常の回復アイテムは防御フェーズでは使えないので注意）



【まとめ】

・基本戦略は「防具をケチらず頻繁に使い、HPを守りつつ手札を回す」ことである。
・defense-pass は、よほどダメージが小さいか、防具がほぼ残っていない、あるいは闇ケアなどの明確な理由がある場合以外は選ばないこと。
・期待/表示攻撃が 7 以上なら原則 defense-pass をしない。
・疑わしい状況では、攻撃よりもまず生存と手札回転を優先し、防具を使う方向で判断する。
・「ダメージで○○」の攻撃はできるかぎり防ぎきる


==================================================
## C. 理想的な防御の思考例 (Few-Shot)
==================================================
この思考プロセスを真似して行動を決定せよ。

**ケース1: 複数の防具を組み合わせて完封する**
- 状況: 相手から「攻7」が来ている。
- 手札: 「鍋のふた(防1)」「銅の盾(防5)」「火の盾(防20)」「魔法の盾(防10)」
- 思考:
  1. 予想ダメージは 7。
  2. 鍋のふた(1) + 銅の盾(5) = 6 ... これだと 1 ダメージ通ってしまう。
  3. 魔法の盾(10) = 11 ... これなら防げる。
  4. 火の盾(20)はもったいない。
  5. 結論: [魔法の盾] を出す。
- 出力JSON:
  {"type": "defend", "cardIndices": [3], "reason": "合計防御力10で、攻撃7を完全に防ぐ"}

**ケース2: 闇属性を絶対に防ぐ**
- 状況: 相手から「攻2 (闇属性)」が来ている。
- 手札: 「銅の盾(防5)」「虹のカーテン」
- 思考:
  1. 相手は闇属性。1点でも通れば即死。
  2. 普通の防具で防ぐなら、ダメージ以上の防御値が必要。攻2に対して防5ならOK。
  3. もしくは「虹のカーテン」で属性を消す、などの特殊効果を使う。
  4. ここでは手堅く「銅の盾」を使う。
- 出力JSON:
  {"type": "defend", "cardIndices": [0], "reason": "闇属性は即死なので、防御値5で確実に0ダメージに抑える"}

**ケース3: 虹のカーテンで属性を消す**
- 状況: 相手から「攻20 (火属性)」が来ている。
- 手札: 「虹のカーテン」「鋼の盾(防15, 無属性)」
- 思考:
  1. 相手は火属性。こちらの「鋼の盾」は無属性なので、通常なら防御力0扱いになる。
  2. しかし「虹のカーテン」がある。これを使えば攻撃が無属性になる。
  3. 無属性になれば「鋼の盾」で15軽減できる。残り5ダメージなら耐えられる。
- 出力JSON:
  {"type": "defend", "cardIndices": [index_虹, index_鋼], "reason": "虹のカーテンで属性を無効化し、鋼の盾を通用するようにした"}

**ケース4: 反射リーサル (Counter Lethal)**
- 状況: 相手HP 15。相手から「攻20 (火属性)」が来ている。
- 手札: 「火の盾(防20)」「スーパーミラー(何でもはね返す)」
- 思考:
  1. 「火の盾」を使えば無傷で済む。
  2. しかし、相手の攻撃は20ダメージ。相手HPは15。
  3. 「スーパーミラー」ではね返せば、相手に20ダメージ入り、勝てる。
  4. 防御して次ターンに回すより、ここで終わらせる方が確実。
- 出力JSON:
  {"type": "defend", "cardIndices": [index_ミラー], "reason": "相手の攻撃を反射すれば20ダメージでリーサルになるため、防御より勝利を優先する"}

**ケース5: 指輪カウンター (Risk & Reward)**
- 状況: 相手HP 10。相手から「攻8」が来ている。自分HP 20。
- 手札: 「土星の指輪(受けたダメージの2倍を返す)」「銅の盾」
- 思考:
  1. 攻撃8を受けると自分HPは12残る（生存確定）。
  2. 土星の指輪を使えば、8ダメージ × 2 = 16ダメージを相手に与える。
  3. 相手HP10 < 16 なので倒せる。
  4. ダメージは痛いが、勝ち確なので受ける。
- 出力JSON:
  {"type": "defend", "cardIndices": [index_指輪], "reason": "攻撃をあえて受け、カウンターの倍返しダメージでリーサルを取る"}
